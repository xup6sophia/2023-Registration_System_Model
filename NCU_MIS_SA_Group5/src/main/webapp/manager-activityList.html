<!-- 後端要重寫，用manager-userList改的 -->
<!doctype html>
<html lang="en">

<head>
<!-- Required meta tags -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="statics/scss/all.css">

<!-- ajax -->
<script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>

<title>中央大學藝文中心</title>
</head>

<body>
	<!-- navBar_manager -->
    <script src="statics/js/meta_content/navBar_manager.js"></script>
    
    <!-- tabBar -->
	<div class="bg-tabBar py-5">
		<div class="d-flex justify-content-center mb-3 px-5">
			<div class="row">
				<div class="col">
					<form action="manager-managerList.html">
						<button type="submit" class="btn-tabBar">管理者資料管理</button>
					</form>
				</div>
				<div class="col">
					<form action="manager-userList.html">
						<button type="submit" class="btn-tabBar btn-tabBar-hover">會員資料管理</button>
					</form>
				</div>
				<div class="col">
					<form action="manager-activityList.html">
						<button type="submit" class="btn-tabBar">活動資料管理</button>
					</form>
				</div>
			</div>
		</div>
	</div>
	
    <nav>
        <div class="nav nav-tabs d-flex justify-content-center mt-3" id="nav-tab" role="tablist">
            <button class="nav-link active" id="nav-all-tab" data-bs-toggle="tab" data-bs-target="#nav-all"
                type="button" role="tab" aria-controls="nav-all" aria-selected="true">所有活動</button>
            <button class="nav-link" id="nav-textbook-tab" onclick="getEventByEventType('1')"
                data-bs-toggle="tab" data-bs-target="#nav-textbook" type="button" role="tab"
                aria-controls="nav-textbook" aria-selected="false">演講座談</button>
            <button class="nav-link" id="nav-reading-tab" onclick="getEventByEventType('2')"
                data-bs-toggle="tab" data-bs-target="#nav-reading" type="button" role="tab"
                aria-controls="nav-reading" aria-selected="false">藝文特展</button>
            <button class="nav-link" id="nav-clothe-tab" onclick="getEventByEventType('3')"
                data-bs-toggle="tab" data-bs-target="#nav-clothe" type="button" role="tab"
                aria-controls="nav-clothe" aria-selected="false">音樂舞台</button>
            <button class="nav-link" id="nav-makeup-tab" onclick="getEventByEventType('4')"
                data-bs-toggle="tab" data-bs-target="#nav-makeup" type="button" role="tab"
                aria-controls="nav-makeup" aria-selected="false">107影享會</button>
            <button class="nav-link" id="nav-necessary-tab" onclick="getEventByEventType('5')"
                data-bs-toggle="tab" data-bs-target="#nav-necessary" type="button" role="tab"
                aria-controls="nav-necessary" aria-selected="false">工作坊</button>
            <button class="nav-link" id="nav-electronic-tab" onclick="getEventByEventType('6')"
                data-bs-toggle="tab" data-bs-target="#nav-electronic" type="button" role="tab"
                aria-controls="nav-electronic" aria-selected="false">崑曲展演</button>
            <!-- <button class="nav-link" id="nav-diet-tab" onclick="getEventByEventType('飲食')"
                data-bs-toggle="tab" data-bs-target="#nav-diet" type="button" role="tab"
                aria-controls="nav-diet" aria-selected="false">飲食</button> -->
            <button class="nav-link" id="nav-other-tab" onclick="getEventByEventType('7')"
                data-bs-toggle="tab" data-bs-target="#nav-other" type="button" role="tab"
                aria-controls="nav-other" aria-selected="false">其他</button>
                
            <button class="btn btn-outline-primary" onclick="location.href='center-product-addNew.html'" type="button">新增活動</button>

        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-home-tab">
            <!-- 活動列表 所有活動 -->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-textbook" role="#nav-textbook" aria-labelledby="nav-textbook-tab">
            <!-- 活動列表 演講座談-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_speech" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-reading" role="#nav-reading" aria-labelledby="nav-reading-tab">
            <!-- 活動列表 藝文特展-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_art" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-clothe" role="#nav-clothe" aria-labelledby="nav-clothe-tab">
            <!-- 活動列表 音樂舞台-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_music" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-makeup" role="#nav-makeup" aria-labelledby="nav-makeup-tab">
            <!-- 活動列表 107影享會-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_movie" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-necessary" role="#nav-necessary" aria-labelledby="nav-necessary-tab">
            <!-- 活動列表 工作坊-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_workshop" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-electronic" role="#nav-electronic" aria-labelledby="nav-electronic-tab">
            <!-- 活動列表 崑曲展演-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_kunqu" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <!-- <div class="tab-pane fade" id="nav-diet" role="#nav-diet" aria-labelledby="nav-diet-tab">
            活動列表 
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_diet" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div> -->
        <div class="tab-pane fade" id="nav-other" role="#nav-other" aria-labelledby="nav-other-tab">
            <!-- 活動列表 其他-->
            <div class="containter main_view px-5 py-5">
                <div id="events_panel_other" class="row row-cols-1 row-cols-md-3 g-5">
                	<div>尚無商品</div>
                </div>
            </div>
        </div>
    </div>


	<script>
		//向後端取所有商品
		function getAllEvent() {
			$.ajax({
				type : "GET",
				url : "api/event.do",
				crossDomain : true,
				cache : false,
				dataType : 'json',
				timeout : 5000,
				success : function(response) {
					if (response.status == 200) {
						
						console.log("有回傳成功ㄌ");
						console.log(response.response.data);

						//把每個資料回傳值依序利用addProduct(data)做成卡片再合成panel
						//將panel加至前端(收藏按鈕之狀態依使用者不同有所差異)
						$("#events_panel").append(addProduct(response.response.data));
					}
				},
				error : function() {
					alert("無法連線到伺服器！");
				}
			});
		}
		
		
		function getEventByEventType(eventtype_id) {
						
			// 發出POST的GET請求取得所有會員列表
			$.ajax({
				type : "GET",
				url : "api/event.do",
				crossDomain : true,
				data : "eventtype_id=" + eventtype_id,
				cache : false,
				dataType : 'json',
				timeout : 5000,
				success : function(response) {
					//假設取得成功，更新前端表格
					if (response.status == 200) {
						//演講座談
						if (eventtype_id == "1") {
							$("#events_panel_speech").empty();
							$("#events_panel_speech").append(addProduct(response.response.data));
						} 
						//藝文特展
						if (eventtype_id == "2") {
							$("#events_panel_art").empty();
							$("#events_panel_art").append(addProduct(response.response.data));
						}
						//音樂舞台
						if (eventtype_id == "3") {
							$("#events_panel_music").empty();
							$("#events_panel_music").append(addProduct(response.response.data));
						}
						//107影享會
						if (eventtype_id == "4") {
							$("#events_panel_movie").empty();
							$("#events_panel_movie").append(addProduct(response.response.data));
						} 
						//工作坊
						if (eventtype_id == "5") {
							$("#events_panel_workshop").empty();
							$("#events_panel_workshop").append(addProduct(response.response.data));
						} 
						//崑曲展演
						if (eventtype_id == "6") {
							$("#events_panel_kunqu").empty();
							$("#events_panel_kunqu").append(addProduct(response.response.data));
						}
						//其他
						if (eventtype_id == "7") {
							$("#events_panel_other").empty();
							$("#events_panel_other").append(addProduct(response.response.data));
							$("#events_panel_other").append(addInfoHtml());
						}
					}
				},
				error : function() {
					alert("無法連線到伺服器!!!");
				}
			});
		}
		
		function addInfoHtml() {
			let info_html = '';
			
			//info_html = '<div class="container container-fluid d-flex justify-content-center main_view"><h3>沒有商品囉~</h3></div>';
			
			return info_html;
		}
		

		// 將資料庫的資料套用在html模板中
		function addProduct(data) {
			let card_html = '';
			
			$.each(data, function(index, value) {
				
				card_html += '<div class="col">';
				card_html += '<div class="card shadow">';
				card_html += '<div class="card-header d-flex justify-content-between">';
				card_html += '<div><b>' + value['eventtype_description']+ '</b></div>';
				card_html += '</div>';
				card_html += '<div class="div-product">';
				card_html += '<img src="' + value['event_info']['event_image'] + '" class="product-img" alt="商品圖片">';
				card_html += '</div>';
				card_html += '<div class="card-body">';
				card_html += '<h5 class="card-title">' + value['event_info']['event_title'] + '</h5>';
				card_html += '<p> </p>';
				card_html += '<h6 class="card-subtitle mb-2 text-muted">' + value['event_info']['event_place'] + '</h6>';
				//card_html += '<p>' + value['eventsessions_info'][0]['event_id'] + '</p>';
				card_html += '<div>';
				//card_html += '<button action="manager-activityList-editActivity.html?event_id=' + value['eventsessions_info'][0]['event_id'] + '" class="btn btn-outline-secondary" id="collectBtn_' + value['eventsessions_info'][0]['event_id'] + '"><i class="bi bi-bookmark-heart"></i>報名清單</button>';
				card_html += '<a href="javascript: deleteEvent('+ value['eventsessions_info'][0]['event_id']+ ')" class="btn btn-outline-danger">刪除</a>';
				card_html += '<a href="manager-activityList-editActivity.html?event_id=' + value['eventsessions_info'][0]['event_id'] + '" class="btn btn-outline-primary">修改></a>';
				card_html += '</div></div></div></div>';
			
		    })

			return card_html;
		}
		
		function deleteEvent(event_id) {
			var check = window.confirm("確認刪除活動？");
			if (check == true) {
				console.log("You pressed OK!");
				var request = {
					'event_id' : event_id.toString()
				};
				var data_string = JSON.stringify(request);
				$.ajax({
	                type: "DELETE",
	                url: "api/event.do",
	                data: data_string,
	                crossDomain: true,
	                cache: false,
	                dataType: 'json',
	                timeout: 5000,
	                success: function (response) {
	                	
	                    if (response.status == 200) {
	                    	alert("刪除成功!");
	                    	document.location.href = "manager-activityList.html";
	                    }
	                },
	                error: function () {
	                    alert("無法連線到伺服器！");
	                }
	            });      
			} else {
				console.log("You pressed Cancel!");
			}
		 }
		
		
		
		//渲染時執行getAllMember()
		$(document).ready(function() {
			getAllEvent();	
		});
	</script>

	<!-- footer -->
	<script src="statics/js/meta_content/footer.js"></script>


	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
		crossorigin="anonymous"></script>
</body>

</html>