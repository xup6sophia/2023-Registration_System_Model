<!doctype html>
<html lang="en">

<head>
<!-- Required meta tags -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="statics/scss/all.css">

<!-- ajax -->
<script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>



<title>中央大學藝文中心</title>
</head>

<body>
	<!-- navBar -->
	<script src="statics/js/meta_content/navBar_manager.js"></script>
    
    <!-- tabBar -->
    <div class="bg-tabBar py-5">
        <div class="d-flex justify-content-center mb-3 px-5">
            <div class="row">
                <div class="col">
                    <form action="manager-managerList.html">
                        <button type="submit" class="btn-tabBar">管理者資料管理</button>
                    </form>
                </div>
                <div class="col">
                    <form action="manager-userList.html">
                        <button type="submit" class="btn-tabBar">會員資料管理</button>
                    </form>
                </div>
                <div class="col">
                    <form action="manager-activityList.html">
                        <button type="submit" class="btn-tabBar btn-tabBar-hover">活動資料管理</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 活動資訊 -->
    <form id="form1" name="form1" accept-charset="utf-8" class="needs-validation">
        <div class="containter py-5 px-5 main_view">
            <div class="d-flex justify-content-between mb-3 px-5">
                <div class="myTitle-main">上架活動資訊填寫</div>
                <div class="submit d-flex justify-content-center">
                    <input class="btn-cool" type="submit" value="新增活動" id="submit">
                </div>
            </div>
        <!-- POST -->
        <div style="display:none;"><input type="hidden" name="_method" value="POST"></div>
        <!-- 顯示內容 -->
        <div class="px-5 mb-3">
            <label for="input_event_title" class="form-label">活動名稱 *</label>
            <input class="form-control" name="input_event_title" type="text" id="input_event_title" placeholder="你的活動名稱" required>
        </div>
        <div class="px-5 mb-3">
            <label for="input_event_type" class="form-label">活動類別 *
            </label>
            <select id="input_event_type" class="form-select" name="input_event_type" type="number" required>
                <option selected>選擇活動類別</option>
                <option value=1>演講座談</option>
                <option value=2>藝文特展</option>
                <option value=3>音樂舞台</option>
                <option value=4>107影享會</option>
                <option value=5>工作坊</option>
                <option value=6>崑曲展演</option>
                <!-- <option value="飲食">飲食</option> -->
                <option value=7>其他</option>
            </select>
        </div>
        <div class="px-5 mb-3">
            <label for="input_introduction" class="form-label">活動介紹 *</label>
            <input class="form-control" name="input_introduction" type="text" id="input_introduction" placeholder="你的活動介紹"
                required>
        </div>
        
        <div class="px-5 mb-3">
            <label for="input_start_date" class="form-label">活動開始日期 *</label>
            <input class="form-control" name="datepicker" type="datetime-local" id="input_start_date" placeholder="活動開始日期"
                required>
        </div>
        <div class="px-5 mb-3">
            <label for="input_end_date" class="form-label">活動結束日期 *</label>
            <input class="form-control" name="datepicker" type="datetime-local" id="input_end_date" placeholder="活動結束日期"
                required>
        </div>
        
        <div class="px-5 mb-3">
            <label for="input_place" class="form-label">活動地點 *</label>
            <input class="form-control" name="place" type="text" id="input_place" placeholder="活動地點"  required>
        </div>
        <div class="px-5 mb-3">
            <label for="input_notification" class="form-label">活動注意事項</label>
            <input class="form-control" name="notice" type="text" id="input_notification" placeholder="你的活動注意事項" >
        </div>
        <div class="px-5 mb-5">
            <label for="input_image" class="form-label">選擇活動照片 *</label>
            <input class="form-control" name="picture" type="file" id="input_image" value= "123456.jpg" required>
        </div>
    </form>
        
        
    <form id="theForm" name="theForm" accept-charset="utf-8" class="needs-validation">
        <div class="px-5 mb-3">
            <label for="input_end_date" class="form-label">活動場次 </label>
            <input type="button" class="btn btn-outline-primary" id="btn"  value="新增" onclick="checkForm1()">
        </div>
        

        <div class="px-5 mb-3" id = "eventsesion">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <label for="input_eventsession_title" class="form-label">活動場次名稱 *</label>
                    <input class="form-control" name="input_eventsession_title" type="text" id="input_eventsession_title" placeholder="你的活動場次名稱" required>

                    <label for="input_eventsession_start_date" class="form-label">場次開始時間 *</label>
                    <input class="form-control" name="input_eventsession_start_date" type="datetime-local" id="input_eventsession_start_date" placeholder="活動場次開始時間" required>

                    <label for="input_eventsession_end_date" class="form-label">場次結束時間 *</label>
                    <input class="form-control" name="input_eventsession_end_date" type="datetime-local" id="input_eventsession_end_date" placeholder="活動場次結束時間" required>

                    <label for="input_eventsession_limitnum" class="form-label">人數限制 * <label>
                    <p> </p>
                    <input class="form-control" name="input_num" type="number" id="input_num" placeholder="活動場次人數限制" required>
                </div>
            </div>   
        </div>
    </form>

</div>
<div class="containter py-5 px-5 main_view">
    <!-- 清單 -->
    <div class="container container-fluid py-5">
        <div class="d-flex justify-content-start mb-3">
            <div class="myTitle-main">已新增場次</div>
        </div>

        <table id="event_list_table" class="table table-hover">
            <thead>
                <tr>
                    <th scope="col">場次名稱</th>
                    <th scope="col">開始時間</th>
                    <th scope="col">結束時間</th>
                    <th scope="col">人數限制</th>
                    <th scope="col">功能</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

</div>
    <script>
        function checkForm1(){
            var frm1 = document.forms["form1"];
            var event_title = frm1.elements["input_event_title"].value;
            var event_start_date = frm1.elements["input_start_date"].value;
            var event_end_date = frm1.elements["input_end_date"].value;
            var place = frm1.elements["input_place"].value;
            var image = frm1.elements["input_image"].value;
            if(event_title == ""){
                alert("錯誤:活動名稱不得為空");
            }
            else if(event_start_date==""){
                alert("錯誤:活動開始時間不得為空");
            }
            else if(event_end_date==""){
                alert("錯誤:活動結束時間不得為空");
            }
            else if(place==""){
                alert("錯誤:活動地點不得為空");
            }
            else if(image==""){
                alert("錯誤:活動照片不得為空");
            }
            else{
                checkForm();
            }


        }
        function checkForm(){
            var frm = document.forms["theForm"];
            var title = frm.elements["input_eventsession_title"].value;
            var start_date = frm.elements["input_eventsession_start_date"].value;
            var end_date = frm.elements["input_eventsession_end_date"].value;
            var limitnum = frm.elements["input_num"].value;
            if(title == ""){
                alert("錯誤:場次名稱不得為空");
            }else if(start_date==""){
                alert("錯誤:場次開始時間不得為空");
            }else if(end_date==""){
                alert("錯誤:場次結束時間不得為空");
            }else if(limitnum==""){
                alert("錯誤:場次人數限制不得為空");
            }else{
                AddEventSession();
            }


        }
        var arr=[];
        var num=0;
        var tbody = document.querySelector('tbody');
        function AddEventSession()
        {   

            num+=1;
            // console.log(num);
            var tr = document.createElement('tr');
            tbody.appendChild(tr);
            var oEventText=document.getElementById("input_eventsession_title");
            var oStartText=document.getElementById("input_eventsession_start_date");
            
            var oEndText=document.getElementById("input_eventsession_end_date");
            var oNumText=document.getElementById("input_num");

            var oEventP =document.createElement("EventP");
            var oStartP =document.createElement("StartP");
            var oEndP =document.createElement("EndP");
            var oNumP =document.createElement("NumP");

            oEventP.innerHTML=oEventText.value;
            oStartP.innerHTML=oStartText.value;
            oEndP.innerHTML=oEndText.value;
            oNumP.innerHTML=oNumText.value;
            
            var td = document.createElement('td');
            td.appendChild(oEventP);
            tr.appendChild(td);
            var td = document.createElement('td');
            td.appendChild(oStartP);
            tr.appendChild(td);
            var td = document.createElement('td');
            td.appendChild(oEndP);
            tr.appendChild(td);
            var td = document.createElement('td');
            td.appendChild(oNumP);
            tr.appendChild(td);
            var td = document.createElement('td');
            td.innerHTML = '<a href="javascript:;">删除</a>';
            tr.appendChild(td);

            var eventsession={
                
                "eventsessions_title":oEventText.value,
                "eventsessions_limitnum":oNumText.value,
                "eventsessions_start_date":oStartText.value,
                "eventsessions_end_date":oEndText.value,
                "is_Canceled":0,

                
            }
            arr.push(eventsession);

            var as = document.querySelectorAll('a');
            for(var i = 0; i < as.length; i++){
                as[i].onclick = function(){
                    tbody.removeChild(this.parentNode.parentNode);
                    num-=1;
                }
            }


        }
    </script>
    
    

    <script type="text/javascript">
        var eventsessioncount = 1;

    
    
   		// var event_id = JSON.parse(sessionStorage.getItem("event_id"));
   		// let event_id_string = event_id.toString();
    
        $(document).ready(function () {
            // 處理表單點擊事件
            var $form = $('#submit');
            $form.click(function () {
                submit();
            });

            function submit() {
            	
            	
	            // 將前端表單填寫值存進變數
	            var event_title = $('#input_event_title').val();
	            var event_type = $('#input_event_type').val();
	            var introduction = $('#input_introduction').val();
                var start_date = $('#input_start_date').val();
                var end_date = $('#input_end_date').val();
                var notification = $('#input_notification').val();
	            var content = $('#input_content').val();
	            var place = $('#input_place').val();
	            var image = "statics/asset/img/textbool1.png";
	            
	            // 格式設定(未做)
	
	            // 將資料組成JSON格式(格式名稱參照文件)
	            var data_object = {
	            	"event_title" : event_title,
	            	"eventtype_id" : event_type,
	            	"event_introduction" : introduction,
	            	"event_start_date" : start_date,
                    "event_end_date" : end_date,
                    "event_place" : place,
                    "event_notification" : notification,
                    "event_content":content,
	            	"event_image" : image,
                    "event_sessions":arr
	            };
	            
	            // console.log(data_object);
	
	            // 將JSON格式轉換成字串
	            var data_string = JSON.stringify(data_object);

                console.log(data_string);
	
	            // 發出POST的AJAX請求(未做)
	            $.ajax({
	                type: "POST",
	                url: "api/event.do",
	                data: data_string,
	                crossDomain: true,
	                cache: false,
	                dataType: 'json',
	                timeout: 5000,
	                success: function (response) {
	                	
	                    if (response.status == 200) {
	                    	alert("上架成功!");
	                    	document.location.href = "center-product-browse.html";
	                    }
	                },
	                error: function () {
	                    alert("無法連線到伺服器！");
	                }
	            });      
            }
        });
    </script>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
</body>

</html>